## Ubuntu 24.04, **glibc 2.39**
## Tools: pwndbg, pwntools, gdb, build-essential
FROM ubuntu24-base:latest
ENV LANG=en_US.UTF-8
ENV LANGUAGE=en_US:en
ENV LC_ALL=en_US.UTF-8

# go back to root to simplify next few steps
USER root

# install dependencies: build deps, python3.10 deps, basic utils
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    gdb \
    bear \
    tmux \
    file \
    procps \
    python3-dev \
    libffi-dev \
    zlib1g-dev \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# install pwndbg
RUN curl -qsLk 'https://install.pwndbg.re' -o /opt/pwndbg.sh \
    && chmod +x /opt/pwndbg.sh \
    && bash /opt/pwndbg.sh -t pwndbg-gdb

# allow pip install outside venv (PEP 668)
RUN echo '[global]\nbreak-system-packages = true' > /etc/pip.conf

# install pwntools
ADD ./shared/pwntools.sh /opt/pwntools.sh
RUN /opt/pwntools.sh

# clean up caches after install steps/scripts run
RUN apt-get clean && rm -rf /var/lib/apt/lists/*

USER ubuntu
VOLUME [ "/home/ubuntu/src" ]
WORKDIR /home/ubuntu/src

RUN echo "export PATH=$HOME/.local/bin:$PATH" >> /home/ubuntu/.bashrc
ENTRYPOINT [ "/bin/bash" ]
