## Debian 11, **glibc 2.31**
## Tools: python 3.10 pwndbg, pwntools, gdb, build-essential
FROM debian11-base:latest
ENV LANG=en_US.UTF-8
ENV LANGUAGE=en_US:en
ENV LC_ALL=en_US.UTF-8

# go back to root to simplify next few steps
USER root

# install dependencies: build deps, python3.10 deps, basic utils
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    gdb \
    bear \
    tmux \
    file \
    procps \
    python3-dev \
    libffi-dev \
    zlib1g-dev \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# compile python 3.10 from source (debian 11 only provides up to 3.9 in the package repos)
ADD shared/build_python3.10.sh /opt/build_python3.10.sh
RUN /opt/build_python3.10.sh

# install pwndbg
WORKDIR /opt
RUN curl -qsLk 'https://install.pwndbg.re' -o /opt/pwndbg.sh && chmod +x /opt/pwndbg.sh
RUN bash /opt/pwndbg.sh -t pwndbg-gdb

# install pwntools
ADD ./shared/pwntools.sh /opt/pwntools.sh
RUN /opt/pwntools.sh

# clean up caches after install steps/scripts run
RUN apt-get clean && rm -rf /var/lib/apt/lists/*

USER user
VOLUME [ "/home/user/src" ]
WORKDIR /home/user/src

RUN echo "export PATH=$HOME/.local/bin:$PATH" >> /home/user/.bashrc
ENTRYPOINT [ "/bin/bash" ]

